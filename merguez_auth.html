<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Merguez Auth</title>
  <style>
    body{
      font-family:sans-serif;
      background:#222222;
      color:#eeeeee;
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    #barbecue{
      width:80%;
      height:260px;
      border-radius:6px;
      position:relative;
      background:linear-gradient(180deg,#0f0f0f 0,#161616 100%);
      box-shadow:inset 0 6px 20px rgba(0,0,0,.7);
      padding:20px;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .rails{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      justify-content:space-around;
      padding:20px 0;
      z-index:1;
    }

    .rail{
      height:6px;
      border-radius:999px;
      background:linear-gradient(90deg,#555,#777,#555);
      box-shadow:0 2px 8px rgba(0,0,0,.6) inset;
    }

    .merguez{
      width:40px;
      height:100%;
      margin:40px;
      border-radius:20px;
      background-color:#ff7a4d;
      transition:background-color 0.2s linear;
      z-index:2;
    }

    .controls{
      margin: 20px;
      display: inline-block;
    }

    button{
      margin:10px;
      padding:8px 14px;
      font-size:16px;
      cursor:pointer;
      border-radius:6px;
      border:none;
    }

    .grillBtn{background:#ff7a4d;}

    .stopBtn{
      display: none;
      background:#555555;
      color:#ffffff;
    }

    .timer{
      margin-top:5px;
      font-size:20px;
      text-align: center;
      color:#ffffff;
    }
  </style>
</head>
<body>

  <div id="barbecue">
    
    <div class="rails">
      <div class="rail"></div>
      <div class="rail"></div>
      <div class="rail"></div>
      <div class="rail"></div>
      <div class="rail"></div>
    </div>

  </div>

  <div id="barbecue_controls"></div>


  <script>

    const nb_merguez = 5;
    const barbecue = document.getElementById('barbecue');
    const barbecue_controls = document.getElementById('barbecue_controls');
    var grill_times = [0.0 * nb_merguez];

    function createMerguez(id){
      
      //Create Merguez
      const merguez = document.createElement('div');
      merguez.className = 'merguez';
      barbecue.appendChild(merguez);
      
      //Create Merguez Controls
      const controls = document.createElement('div');
      controls.className = 'controls';

      const box_label = document.createElement('div');
      const label = document.createElement('strong');
      label.textContent = `Merguez ${id}`
      box_label.appendChild(label);
      controls.appendChild(box_label);
      
      const grillBtn = document.createElement('button');
      grillBtn.className = 'grillBtn';
      grillBtn.textContent = 'Grill';
      controls.appendChild(grillBtn);
      
      const stopBtn = document.createElement('button');
      stopBtn.className = 'stopBtn';
      stopBtn.textContent = 'Stop';
      controls.appendChild(stopBtn);

      const timer = document.createElement('div');
      timer.className = 'timer';
      timer.textContent = '0.0s';
      controls.appendChild(timer);

      barbecue_controls.appendChild(controls);

      let startTime = null;
      let grilling = false;
      let rafId = null;

      function grill(timestamp){
        if(!grilling){return;}
        if(!startTime){startTime = timestamp;}

        // 10 seconds
        const elapsed = (timestamp - startTime) / 1000;
        const t = Math.min(elapsed / 10, 1);

        // Update timer
        timer.textContent = elapsed.toFixed(1) + 's';
        grill_times[id-1] = parseFloat(elapsed.toFixed(1));

        // Update merguez color
        // #ff7a4d (r=255,g=122,b=77) to black (r=0,g=0,b=0)
        const r = Math.floor(255 * (1 - t));
        const g = Math.floor(122 * (1 - t));
        const b = Math.floor(77 * (1 - t));

        const color = `rgb(${r},${g},${b})`;
        merguez.style.backgroundColor = color;

        if(t < 1){
          rafId = requestAnimationFrame(grill);
        } else {
          grilling = false;
        }
      }

      grillBtn.addEventListener('click', ()=>{
        grillBtn.style.display = "none";
        stopBtn.style.display = "block";
        grilling = true;
        startTime = null;
        timer.textContent = '0.0s';
        cancelAnimationFrame(rafId);
        requestAnimationFrame(grill);
      });

      stopBtn.addEventListener('click', ()=>{
        console.log(grill_times);
        grilling = false;
        cancelAnimationFrame(rafId);
      });

    }

    for(let i=1;i<=5;i++) createMerguez(i);

  </script>
</body>
</html>